generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Customer {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  address   String?
  phone     String?
  email     String?
  vehicles  Vehicle[]
  documents Document[]
  history   ServiceRecord[]
  appointments Appointment[]
  todos     Todo[]
  lexwareId String?   @unique // ID from Lexware Office
  tireStorageSpot String? // Linked Tire Storage Spot (e.g. "A10")
  createdAt DateTime  @default(now())
}

model TireStorageSpot {
  id        String   @id // Coordinate key like "9-0"
  label     String?
  status    String?
  updatedAt DateTime @updatedAt
}

model Vehicle {
  id             Int      @id @default(autoincrement())
  vin            String   @unique
  licensePlate   String
  make           String
  model          String
  hsn            String?
  tsn            String?
  firstRegistration DateTime?
  mileage        Int?     // Aktueller KM-Stand
  fuelType       String?  // Benzin, Diesel, Elektro, etc.
  transmission   String?  // Manuell, Automatik
  registrationDoc String? // Path to file
  notes          String? // Internal notes
  customerId     Int
  customer       Customer @relation(fields: [customerId], references: [id])
  appointments   Appointment[]
  history        ServiceRecord[]
  createdAt      DateTime @default(now())
}

model Document {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  type       String   @default("manual") // manual, invoice, registration
  lexwareId  String?  @unique
  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id])
  serviceRecordId Int?
  serviceRecord ServiceRecord? @relation(fields: [serviceRecordId], references: [id])
  createdAt  DateTime @default(now())
}

model ServiceRecord {
  id          Int      @id @default(autoincrement())
  date        DateTime @default(now())
  description String
  mileage     Int?     // KM-Stand bei Service
  cost        Float?
  lexwareId   String?  @unique
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id])
  vehicleId   Int?
  vehicle     Vehicle? @relation(fields: [vehicleId], references: [id])
  documents   Document[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt
}

model Todo {
  id          Int      @id @default(autoincrement())
  title       String
  isDone      Boolean  @default(false)
  customerId  Int?
  customer    Customer? @relation(fields: [customerId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Settings {
  id        Int     @id @default(autoincrement())
  apiKey    String? // Lexware API Key
  openaiKey String? // OpenAI API Key
  carPartsUser String? // Car Parts Catalog Username
  carPartsPass String? // Car Parts Catalog Password
  conradUser   String? // Conrad Username
  conradPass   String? // Conrad Password
  lexwareUser String? // Lexware Dashboard Username
  lexwarePass String? // Lexware Dashboard Password
  syncEnabled Boolean @default(false)
  autoSync  Boolean @default(false)
  lastSync  DateTime?
  theme     String  @default("dark")
}

model ServiceTemplate {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Appointment {
  id          Int      @id @default(autoincrement())
  title       String
  start       DateTime
  end         DateTime
  description String?
  status      String   @default("open") // open, in-progress, done, picked-up
  customerId  Int?
  customer    Customer? @relation(fields: [customerId], references: [id])
  vehicleId   Int?
  vehicle     Vehicle? @relation(fields: [vehicleId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ShopClosure {
  id          Int      @id @default(autoincrement())
  start       DateTime
  end         DateTime
  description String
  createdAt   DateTime @default(now())
}
